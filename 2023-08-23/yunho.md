# 사전 조건, 사후 조건, 변경에 유연한 함수

## 배경

테스트 설계에 관한 내용을 공부하다가 해당 내용이 테스트 뿐만 아니라 `변경에 유연한 함수`와도 밀접한 관련이 있다는 생각이 들었어요.

## 요약

### 사전 조건과 사후 조건

사전 조건

- 함수가 제대로 동작하도록 하는 조건
- 간단하게 예시로는 early return이 있어요. 로직을 수행하기 전에 검증을 해서 실제 로직에는 올바른 입력 값만 들어오게 하기~

```ts
function TaxCalculator(tax: number) {
  if (tax < 0) {
    throw Error('세금은 음수가 될 수 없다');
  }
  let taxValue = 0;
  // 계산
  return taxValue;
}
```

사후 조건

- 함수가 산출물로 보장하는 조건
- 이후 해당 함수를 사용하는 곳에서 return 값을 신뢰할 수 있다. 내부 로직 신경 안써도 됨

```ts
function TaxCalculator(tax: number) {
  // 사전 조건 생략
  let taxValue = 0;
  // 계산
  if (tax < 0) {
    throw Error('세금은 음수가 될 수 없다');
  }
  return taxValue;
}
```

### 지향해야하는 함수

약한 조건을 사용해야할 지 강한 조건을 사용해야할 지 접답은 물론 없어요. 간단하게 예를 들면 강한 조건은 휴먼 에러 및 기타 실수를 줄일 수 있지만, 그만큼 조건을 코드화하는데 투입해야하는 비용이 클 수 있어요

하지만 `변경에 유연한 함수`를 목적에 두었을 때 아래와 같은 방향으로 함수를 작성해야 한다고 생각

`강한 사전 조건` + `약한 사후 조건`

- 사전 조건을 약하게 변경하면 함수 간 관계가 깨지지 않는다.
- 사후 조건을 강하게 변경하면 함수 간 관계가 깨지지 않는다.
- `관계가 꼐지지 않는다 === 다른 함수에 영향을 덜 끼친다.`

사전 조건 변경 예시

- 기존: value >= 0
- case1: TaxCalculator(100)
- case2: TaxCalculator(200)
- 변경 조건: value >= 150
- 두 가지 사용처에서 조건을 변경했을 때 case1에서는 에러를 반환 => 사전 조건을 강화하면( 0 ~ 무한 -> 150 ~ 무한) 해당 함수를 사용하는 곳에서 문제가 발생할 여지가 있다.

사후 조건 변경 예시

- 기존: value >= 0
- result = TaxCalculator(100)
- 변경 조건: value >= -100
- 세금이 음수가 되면 사용처에서 문제가 발생할 수 있다. 하지만 value >= 100으로 했을 때는 문제가 없다. 이미 반환 값을 0과 무한대 사이의 값으로 하고 있고, 100에서 무한대는 이전 도메인의 부분 집합이기 때문.
- 사후 조건을 강화하거나 제한해도 의존 함수를 망가뜨리지 않는다.

### 정리

> 출처: Design by Contract: [객체 지향 개발 5대 원리](https://www.nextree.co.kr/p6960/)

- 서브 클래스에서는 기반 클래스의 사전 조건과 같거나 더 약한 수준에서 사전 조건을 대체할 수 있고, 기반 클래스의 사후 조건과 같거나 더 강한 수준에서 사후 조건을 대체할 수 있다.
- 기반 클래스를 서브 클래스로 치환 가능하게 하려면 받아들이는 선 조건에서 서브 클래스의 제약사항이 기반 클래스의 제약 사항보다 느슨하거나 같아야 합니다. 만약 제약조건이 더 강하다면 기반 클래스에서 실행되던 것이 서브 클래스의 강 조건으로 인해 실행되지 않을 수도 있기 때문입니다. 반면 서브 클래스의 후 조건은 같거나 더 강해야 하는데, 약하다면 기반 클래스의 후 조건이 통과시키지 않는 상태를 통과시킬 수도 있기 때문입니다.

### React 컴포넌트에 적용

`적절한 예시가 생각나지 않지만 JS의 함수 뿐만 아니라 React의 컴포넌트에서 pros를 넘겨줄 떄도, 같은 고민을 녹여낼 수 있다고 생각해요.`

적절한 예시는 고민해서 스터디 전에 채워 넣어 볼게여 😓

## 참고 자료

- [이펙티브 소프트웨어 테스팅](https://www.yes24.com/Product/Goods/117586096)
- https://armadillo-dev.github.io/design/programming/desing-by-contract/
- https://www.nextree.co.kr/p6960/
